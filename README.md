# 糖尿病預測模型 (Diabetes Prediction Model)

這個專案使用機器學習技術，基於健康指標資料集訓練模型以預測糖尿病風險。專案利用GPU加速處理與多種進階機器學習技術，提供高效且精確的預測結果。

## 專案概述

本專案利用 BRFSS 2015 健康指標數據集，開發與評估多種機器學習模型來預測個體是否患有糖尿病。各模型透過多種特徵工程技術與優化方法進行訓練，並提供詳細的效能比較分析。

## 資料集

使用了三個主要資料集：
- `diabetes_binary_5050split_health_indicators_BRFSS2015.csv` (5050分割版本)
- `diabetes_012_health_indicators_BRFSS2015.csv` (包含前期糖尿病分類)
- `diabetes_binary_health_indicators_BRFSS2015.csv` (二元分類完整版本)

每個資料集包含 22 個欄位，涵蓋多種健康指標，如血壓、膽固醇水平、BMI、生活習慣等特徵。

## 特徵工程

專案包含豐富的特徵工程與預處理步驟：

1. **基本特徵處理**：缺失值檢查與資料清理
2. **進階特徵創建**：
   - BMI分類（細緻化分類）
   - 年齡分組
   - 綜合健康評分
   - 風險因子綜合指標（權重優化）
   - 生活方式綜合指標
   - 特徵交互作用（BMI與高血壓、年齡與健康狀態等）
   - 非線性特徵（BMI平方項）

3. **特徵選擇**：使用 RFECV (Recursive Feature Elimination with Cross-Validation) 演算法，結合隨機森林進行特徵重要性評估

## 模型架構

專案實現並比較了多種機器學習模型：

1. **邏輯迴歸 (Logistic Regression)**：使用標準化特徵與平衡權重
2. **隨機森林 (Random Forest)**：使用200棵決策樹與平衡類別權重
3. **梯度提升樹 (Gradient Boosting)**：使用200個估計器與適中學習率
4. **XGBoost**：高效能梯度提升實現，使用直方圖加速
5. **加權投票集成 (Weighted Voting Ensemble)**：結合表現最佳的三個模型，根據各模型效能為其分配權重
6. **深度學習神經網路 (PyTorch)**：具有殘差連接的多層神經網路結構

## 模型效能

經過評估，各模型的預測效能如下：

| 模型               | 準確率   | 精確率   | 召回率   | F1分數   |
|--------------------|---------|---------|---------|---------|
| Gradient Boosting  | 0.7470  | 0.7284  | 0.7877  | 0.7569  |
| XGBoost            | 0.7457  | 0.7251  | 0.7912  | 0.7567  |
| Logistic Regression| 0.7442  | 0.7328  | 0.7686  | 0.7503  |
| Random Forest      | 0.7302  | 0.7146  | 0.7667  | 0.7397  |
| Weighted Voting    | 0.7467  | 0.7288  | 0.7860  | 0.7563  |
| Deep Learning      | 0.7407  | 0.6885  | 0.8789  | 0.7722  |

### 結果分析

- **梯度提升樹**為表現最佳的單一傳統機器學習模型，準確率達 74.70%
- **XGBoost**在召回率方面表現優秀 (79.12%)，適合優先識別潛在病例
- **深度學習模型**在F1分數方面表現最佳 (77.22%)，且具有最高的召回率 (87.89%)，特別適合需要最大化識別糖尿病患者的場景
- **集成模型**在各項指標上表現均衡，準確率為 74.67%

## 主要功能

- **資料載入與預處理**：`load_and_preprocess_data()`
- **特徵選擇**：`enhanced_feature_selection()`
- **XGBoost 模型訓練**：`train_xgboost_model()`
- **多模型訓練與評估**：`train_and_evaluate_models()`
- **集成模型創建**：`create_voting_ensemble()`
- **深度學習模型訓練**：`train_model_with_scheduler()`
- **視覺化與結果分析**：混淆矩陣、ROC曲線、特徵重要性等

## 使用方法

1. 確保安裝所需套件：
```bash
pip install pandas numpy matplotlib seaborn scikit-learn xgboost torch imblearn
```

2. 放置資料集於正確路徑

3. 執行傳統機器學習模型：
```bash
python GPU_ML.py
```

4. 執行深度學習模型：
```bash
python DL_pytorch.py
```

## 輸出結果

程式將產生多種分析圖表與模型：

### 傳統機器學習模型 (儲存於 `diabetes/gpu_enhanced_models` 目錄)：
- 特徵選擇結果
- 特徵重要性分析
- 各模型的混淆矩陣
- ROC曲線
- 模型比較結果
- 已訓練的模型檔案 (.pkl 與 .json 格式)

### 深度學習模型 (儲存於 `diabetes/improved_pytorch_models` 目錄)：
- 混淆矩陣
- ROC曲線 (AUC: 0.825)
- 學習率調度曲線
- 訓練與驗證歷史圖
- 已訓練的模型檔案 (.pth 格式)
- 結果摘要報告

## 深度學習模型架構

專案實現了一個基於 PyTorch 的改進版糖尿病預測神經網路 `ImprovedDiabetesNet`，具有以下特點：

1. **殘差連接 (Residual Connections)**：類似於 ResNet 架構，使模型能夠有效學習更深層次的特徵關係
2. **進階特徵工程**：創建了超過 49 個特徵，並通過特徵選擇保留最具預測力的 30 個特徵
3. **多層感知機結構**：採用 [256, 128, 64, 32] 的隱藏層結構
4. **正則化技術**：
   - Batch Normalization (批次正規化)
   - Dropout (隨機失活，rate=0.25)
   - L1 正則化 (稀疏化權重)
5. **進階激活函數**：LeakyReLU 解決傳統 ReLU 的死亡神經元問題
6. **優化技術**：
   - AdamW 優化器 (帶權重衰減)
   - 帶重啟的餘弦退火學習率調度
   - 早停機制 (patience=20)
7. **資料平衡**：使用 SMOTE 過採樣技術平衡訓練資料
8. **加權損失函數**：為少數類別賦予更高權重，應對不平衡資料集

### 深度學習訓練過程

- 使用 CUDA 加速訓練 (GPU 運算)
- 實施 k-fold 交叉驗證提高模型穩定性
- 進行多輪訓練，搭配早停策略以避免過擬合
- 動態學習率調整，在訓練過程中自動找到最優學習率
- ROC AUC 達到 0.825，展現出優秀的分類能力

## 未來改進方向

1. 進一步最佳化模型超參數
2. 探索更複雜的深度學習架構，如注意力機制和卷積網路的結合
3. 開發更多組合特徵以提升預測效能
4. 優化GPU計算效率
5. 實現更全面的解釋性分析
6. 嘗試混合傳統機器學習和深度學習的集成方法
7. 應用遷移學習技術，利用預訓練模型提升小樣本學習效果
8. 開發醫學實務中可直接使用的預測系統介面

## 授權資訊

本專案遵循 MIT 授權條款